---
import { useState, useEffect } from 'react'
const assetId = new URLSearchParams(Astro.request.url).get('assetid') ?? '';
---

<html lang="nl">
  <head>
    <meta charset="UTF-8" />
    <title>QR Melding â€“ Atalian</title>
  </head>
  <body>
    <main style="max-width: 600px; margin: auto; padding: 2rem; font-family: sans-serif;">
      <h1>Probleem melden</h1>
      <p>Gebruik dit formulier om een probleem te melden via QR-code.</p>

      <form method="post" action="https://example.com/api/melding" onsubmit="handleSubmit(event)">
        <label for="email">Uw e-mailadres</label><br />
        <input id="email" name="email" type="email" required style="width: 100%; margin-bottom: 1rem;" />

        <label for="beschrijving">Probleembeschrijving</label><br />
        <textarea id="beschrijving" name="beschrijving" required rows="5" style="width: 100%; margin-bottom: 1rem;"></textarea>

        <label for="assetid">Asset-ID</label><br />
        <input id="assetid" name="assetid" type="text" value={assetId} readonly style="width: 100%; margin-bottom: 1rem;" />

        <button type="submit">Verzend melding</button>
      </form>

      <script type="text/javascript">
        async function handleSubmit(e) {
          e.preventDefault();
          const form = e.target;
          const payload = {
            ReportText: "Melder: " + form.email.value,
            JobDescr: form.beschrijving.value,
            SpaceId: form.assetid.value,
            Provider: "QRConnect",
            ExternalId: "",
            PriorityId: "",
            ServiceDeskReportTypeId: "601"
          };

          try {
            const res = await fetch(form.action, {
              method: "POST",
              headers: {
                "Content-Type": "application/json"
              },
              body: JSON.stringify(payload)
            });

            if (res.ok) {
              alert("Melding succesvol verzonden.");
              form.reset();
            } else {
              alert("Er is iets misgelopen. Probeer later opnieuw.");
            }
          } catch (err) {
            alert("Verbindingsprobleem.");
          }
        }
      </script>
    </main>
  </body>
</html>
