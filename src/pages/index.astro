<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="/AtalianFavicon.png" />
  <title>Atalian Support</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      max-width: 600px;
      margin: auto;
      background: #f7f7f7;
      color: #333;
    }

    img.logo {
      display: block;
      max-width: 160px;
      margin: 0 auto 1.5rem;
    }

    .lang-switch {
      text-align: right;
      margin-bottom: 1rem;
    }

    .lang-switch a {
      text-decoration: none;
      margin-left: 0.5rem;
      font-weight: bold;
    }

    h1 {
      text-align: center;
      color: #f07c10;
      margin-bottom: 1rem;
    }

    .info, .error, .success {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 4px;
    }

    .info {
      background: #fff;
      border: 1px solid #ddd;
    }

    .error {
      background: #f8d7da;
      color: #721c24;
    }

    .success {
      background: #d4edda;
      color: #155724;
      text-align: center;
      font-size: 1.1rem;
    }

    label {
      display: block;
      margin-top: 1rem;
      font-weight: bold;
    }

    input, textarea {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.25rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    textarea {
      resize: vertical;
    }

    button, .action-button {
      background: #f07c10;
      color: white;
      font-weight: bold;
      padding: 1rem;
      width: 100%;
      border: none;
      border-radius: 4px;
      font-size: 1.2rem;
      margin-bottom: 1rem;
      cursor: pointer;
    }

    button:hover, .action-button:hover {
      background: #d96b0e;
    }

    @keyframes pulse {
      0%   { box-shadow: 0 0 0 0 rgba(240, 124, 16, 0.6); }
      70%  { box-shadow: 0 0 0 15px rgba(240, 124, 16, 0); }
      100% { box-shadow: 0 0 0 0 rgba(240, 124, 16, 0); }
    }

    .highlight-info {
      display: block;
      background: #f07c10;
      color: #003366;
      padding: 1.2rem 1.5rem;
      border-radius: 10px;
      font-size: 1.5rem;
      font-weight: bold;
      text-align: center;
      margin-top: 2rem;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      animation: pulse 2s infinite;
    }

    #btnTerug {
      display: none;
      background: #ddd;
      color: #333;
      font-weight: bold;
      padding: 0.75rem 1rem;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      margin-bottom: 1.5rem;
      cursor: pointer;
      width: auto;
    }

    #btnTerug:hover {
      background: #ccc;
    }
  </style>
</head>
<body>
  <img src="/AtalianLogo.png" alt="Atalian Logo" class="logo" />

  <div class="lang-switch">
    <a id="link-nl">NL</a>&nbsp;|<a id="link-fr">FR</a>
  </div>

  <h1 id="pageTitle">Atalian Support</h1>

  <div style="text-align:center; margin-top:-0.5rem;">
    <a href="tel:+3278152300" style="
      display:inline-block;
      background:#f07c10;
      color:#fff;
      padding:0.5rem 1rem;
      margin-top:0.75rem;
      border-radius:4px;
      text-decoration:none;
      font-size:1.1rem;
      font-weight:bold;
      transition:background 0.3s;
    " onmouseover="this.style.background='#d96b0e'" onmouseout="this.style.background='#f07c10'">
      +32 78 152 300
    </a>
  </div>
  <div id="ruimteInfo" class="info" style="display:none;"></div>
  
  <div id="startKnoppen" style="text-align:center; margin: 2rem 0;">
    <button id="btnStoring" class="action-button">Storing melden</button>
    <button id="btnInstructies" class="action-button">Instructies</button>
  </div>

  <button id="btnTerug" style="margin-top: 1.5rem;">‚¨Ö Terug</button>



  <form id="meldingForm" style="display:none;">
    <label for="email" id="labelEmail">Uw e-mailadres</label>
    <input id="email" name="email" type="email" required />

    <label for="beschrijving" id="labelDesc">Probleembeschrijving</label>
    <textarea id="beschrijving" name="beschrijving" rows="5" required></textarea>

    <button type="submit" id="submitBtn">Verzend melding</button>
  </form>

  <div id="statusBericht" style="display:none;"></div>

<script>
  document.addEventListener('DOMContentLoaded', async () => {
    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');
    let lang = (params.get('lang') || 'nl').toLowerCase();
    if (!['nl', 'fr'].includes(lang)) lang = 'nl';

    const txt = {
      nl: {
        page: 'Atalian Support',
        title: 'Dringend? üëá',
        btnStoring: 'Storing melden',
        btnInstructies: 'Instructies',
        email: 'Uw e-mailadres',
        desc: 'Probleembeschrijving',
        submit: 'Verzend melding',
        loading: 'Laden ruimtegegevens‚Ä¶',
        noId: '‚ö†Ô∏è Geen ruimte-ID opgegeven. Voeg ?id=000898 toe.',
        fetchError: '‚ùå Fout bij ophalen ruimtegegevens:',
        success: '‚úÖ Melding succesvol verzonden!',
        sendError: '‚ùå Verzenden mislukt:',
        terug: '‚¨Ö Terug'
      },
      fr: {
        page: 'Support Atalian',
        title: 'Urgent? üëá',
        btnStoring: 'Signaler un probl√®me',
        btnInstructies: 'Instructions',
        email: 'Votre adresse e-mail',
        desc: 'Description du probl√®me',
        submit: 'Envoyer le signalement',
        loading: 'Chargement‚Ä¶',
        noId: '‚ö†Ô∏è Aucun ID fourni. Ajoutez ?id=000898.',
        fetchError: '‚ùå Erreur lors du chargement :',
        success: '‚úÖ Signalement envoy√© avec succ√®s !',
        sendError: '‚ùå √âchec de l‚Äôenvoi :',
        terug: '‚¨Ö Retour'
      }
    }[lang];

    const info = document.getElementById('ruimteInfo');
    const form = document.getElementById('meldingForm');
    const status = document.getElementById('statusBericht');
    const btnTerug = document.getElementById('btnTerug');

    document.getElementById('pageTitle').textContent = txt.page;
    document.getElementById('btnStoring').textContent = txt.btnStoring;
    document.getElementById('btnInstructies').textContent = txt.btnInstructies;
    document.getElementById('labelEmail').textContent = txt.email;
    document.getElementById('labelDesc').textContent = txt.desc;
    document.getElementById('submitBtn').textContent = txt.submit;
    btnTerug.textContent = txt.terug;

    const base = window.location.pathname;
    params.set('lang', 'nl');
    document.getElementById('link-nl').href = `${base}?${params.toString()}`;
    params.set('lang', 'fr');
    document.getElementById('link-fr').href = `${base}?${params.toString()}`;

    // ‚úÖ Toon ruimtebeschrijving BOVEN de knoppen bij opstart
    if (id) {
      try {
        const res = await fetch(`/.netlify/functions/space?id=${encodeURIComponent(id)}`);
        const data = await res.json();
        if (data.description) {
          info.className = 'highlight-info';
          info.innerHTML = `üìç <strong>${data.description}</strong>`;
          info.style.display = 'block';
        }
      } catch (err) {
        info.className = 'error';
        info.textContent = `${txt.fetchError} ${err.message}`;
        info.style.display = 'block';
      }
    }

    // ‚úÖ Klik op storing melden
    document.getElementById('btnStoring').addEventListener('click', () => {
      document.getElementById('startKnoppen').style.display = 'none';
      document.getElementById('pageTitle').textContent = txt.title;
      btnTerug.style.display = 'inline-block';
      form.style.display = 'block';
    });

    // ‚úÖ Terugknop
    btnTerug.addEventListener('click', () => {
      document.getElementById('startKnoppen').style.display = 'block';
      document.getElementById('pageTitle').textContent = txt.page;
      form.style.display = 'none';
      status.style.display = 'none';
      btnTerug.style.display = 'none';
    });

    // ‚úÖ Verzenden
    form.addEventListener('submit', async e => {
      e.preventDefault();
      status.style.display = 'none';

      const payload = {
        JobDescr: document.getElementById('beschrijving').value,
        ReportText: document.getElementById('email').value,
        SpaceId: id,
        Provider: 'QRConnect',
        ExternalId: '',
        PriorityId: '',
        ServiceDeskReportTypeId: '601'
      };

      try {
        const resp = await fetch('/.netlify/functions/melding', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if (!resp.ok) throw new Error(`Status ${resp.status}`);
        form.style.display = 'none';
        info.style.display = 'none';
        status.className = 'success';
        status.textContent = txt.success;
      } catch (err) {
        console.error(err);
        status.className = 'error';
        status.textContent = `${txt.sendError} ${err.message}`;
      }
      status.style.display = 'block';
    });
  });
</script>
 
</body>
</html>
